<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>Curso - Javascript</title>
    <style>
      body {
        background-color: gray;
        margin: 0px;
      }
      #dvPainel {
        display: flex;
        height: 50px;
        align-items: center;
      }
      .itemPainel {
        margin: 5px;
      }
      #dvJogo {
        width: 960px;
        height: 500px;
        border: 1px solid lightgray;
        background-color: black;
      }
      #dvBola {
        position: absolute;
        top: 240px;
        left: 475px;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background-color: lightgray;
      }
      .barra {
        position: absolute;
        width: 20px;
        height: 140px;
        background-color: lightgray;
        top: 180px;
      }
      .esquerda {
        left: 10px;
      }
      .direita {
        left: 930px;
      }
      label {
        font: bold 16px Arial;
      }
      button {
        font: bold 15px Arial;
        background-color: lightgray;
        border: 1px solid black;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <div id="dvJogo">
      <div id="dvBola"></div>
      <div id="dvJogador" class="barra esquerda"></div>
      <div id="dvCPU" class="barra direita"></div>
    </div>
    <div id="dvPainel">
      <div class="itemPainel">
        <label>Pontos</label>
        <input type="text" id="txtPontos" value="0" size="10" />
      </div>
      <div class="itemPainel">
        <button id="btIniciar">Iniciar</button>
      </div>
    </div>

    <script>
      //Elementos
      var vBtIniciar, vBola, vCpu, vJogador, vPainelTxtPontos

      //Controle de animação
      var game, frame

      //Posições
      var posBolaX, posBolaY, posJogadorX, posJogadorY, posCpuX, posCpuY

      //Direção teclado
      var dirJogadorY

      //Direção
      var bolaX, bolaY
      var cpuY = 0

      //Posições iniciais
      var posBolaInicialX = 475,
        posBolaInicialY = 240,
        posJogadorInicialX = 0,
        posJogadorInicialY = 180,
        posCpuInicialX = 930,
        posCpuInicialY = 180

      //Tamanhos
      var campoX = 0,
        campoY = 0,
        campoWidth = 960,
        CampoHeight = 500
      var barraWidth = 20,
        barraHeight = 140,
        bolaWidth = 20,
        bolaHeight = 20

      //Velocidade
      var velBola, velCpu, velJogador

      //Controle
      var pontos = 0
      var tecla
      var jogo = false

      function controlaJogador() {
        if (jogo) {
          posJogadorY += velJogador * dirJogadorY
          if((posJogadorY + barraHeight) >= CampoHeight || posJogadorY <= 0) {
            posJogadorY += (velJogador * dirJogadorY) * -1
          }
          vJogador.style.top = posJogadorY + 'px'
        }
      }

      function controlaBola() {
        //Movimentação bola
        posBolaX += velBola * bolaX
        posBolaY += velBola * bolaY

        //Colisão com jogador
        if((posBolaX <= posJogadorX + barraWidth) && (posBolaY + bolaHeight >= posJogadorY) && (posBolaY <= posJogadorY + barraHeight)) {
          bolaX *= -1
          bolaY = ((posBolaY + (bolaHeight/2)) - (posJogadorY + (barraHeight/2)))/16
        }
        //Colisão com cpu
        if((posBolaX >= posCpuX - barraWidth) && (posBolaY + bolaHeight >= posCpuY) && (posBolaY <= posCpuY + barraHeight)) {
          bolaX *= -1
          bolaY = ((posBolaY + (bolaHeight/2)) - (posCpuY + (barraHeight/2)))/16
        }

        vBola.style.left = posBolaX + 'px'
        vBola.style.top = posBolaY + 'px'
      }

      function teclaDw(event) {
        tecla = event.key
        if (tecla == 'ArrowUp') {
          dirJogadorY = -1
        } else if (tecla == 'ArrowDown') {
          dirJogadorY = 1
        }
      }

      function teclaUp(event) {
        tecla = event.key
        if (tecla == 'ArrowUp') {
          dirJogadorY = 0
        } else if (tecla == 'ArrowDown') {
          dirJogadorY = 0
        }
      }

      function game() {
        if (jogo) {
          controlaJogador()
          controlaBola()
        }
        frame = requestAnimationFrame(game)
      }

      function iniciaJogo() {
        if (!jogo) {
          cancelAnimationFrame(frame)
          jogo = true
          dirJogadorY = 0

          if((Math.random()*10) < 5) { 
            bolaX = -1 
          } else {
            bolaX = 1 
          }
          bolaY = 0

          posBolaX = posBolaInicialX
          posBolaY = posBolaInicialY
          posJogadorX = posJogadorInicialX
          posJogadorY = posJogadorInicialY
          posCpuX = posCpuInicialX
          posCpuY = posCpuInicialY
          game()
        }
      }

      function inicializar() {
        velBola = velCpu = velJogador = 8
        vBola = document.getElementById('dvBola')
        vCpu = document.getElementById('dvCPU')
        vJogador = document.getElementById('dvJogador')
        vPainelTxtPontos = document.getElementById('txtPontos')
        vBtIniciar = document.getElementById('btIniciar')
        vBtIniciar.addEventListener('click', iniciaJogo)

        document.addEventListener('keydown', event => teclaDw(event))
        document.addEventListener('keyup', event => teclaUp(event))
      }

      window.addEventListener('load', inicializar)
    </script>
  </body>
</html>
